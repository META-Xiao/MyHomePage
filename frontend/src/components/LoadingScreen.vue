<template>
  <transition name="fade">
    <div v-if="isLoading" class="loading-screen">
      <!-- Loading 文字 -->
      <div class="loader">
        <h1>Loading 
          <span class="dots">.</span>
          <span class="dots">.</span>
          <span class="dots">.</span>
        </h1>
      </div>
      
      <!-- 漂浮的有机形状 -->
      <div class="svg-container">
        <svg v-for="i in 5" :key="i" :ref="el => svgRefs[i-1] = el" class="svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <path 
            :ref="el => pathRefs[i-1] = el"
            fill="#927DB7" 
            d="M26.1,-15.9C27.4,-12.9,17.5,-4.2,11.3,14.3C5.1,32.9,2.5,61.4,-5,64.2C-12.5,67.1,-25,44.4,-28.7,27.3C-32.3,10.1,-27.2,-1.3,-21,-7.2C-14.8,-13.1,-7.4,-13.4,2.5,-14.9C12.4,-16.3,24.8,-18.9,26.1,-15.9Z" 
            transform="translate(100 100)" 
          />
        </svg>
      </div>
      
      <!-- 背景波浪 -->
      <svg class="background-waves" width="100%" height="100%" viewBox="0 0 1440 590" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="gradient" x1="0%" y1="50%" x2="100%" y2="50%">
            <stop offset="5%" stop-color="#927db7"></stop>
            <stop offset="95%" stop-color="#dfd5f2"></stop>
          </linearGradient>
        </defs>
        <path 
          ref="wavePath0" 
          class="wave-path-0" 
          fill="url(#gradient)" 
          fill-opacity="0.4"
          d="M 0,600 C 0,600 0,150 0,150 C 69.07271723122237,168.37555228276878 138.14543446244474,186.75110456553756 189,187 C 239.85456553755526,187.24889543446244 272.4909793814433,169.37113402061854 327,173 C 381.5090206185567,176.62886597938146 457.8906480117821,201.76435935198822 526,185 C 594.1093519882179,168.23564064801178 653.9464285714286,109.57142857142857 722,94 C 790.0535714285714,78.42857142857143 866.3236377025036,105.9499263622975 917,131 C 967.6763622974964,156.0500736377025 992.7590206185569,178.62886597938143 1052,187 C 1111.2409793814431,195.37113402061857 1204.6402798232696,189.53460972017672 1275,181 C 1345.3597201767304,172.46539027982328 1392.6798600883653,161.23269513991164 1440,150 C 1440,150 1440,600 1440,600 Z"
        />
        <path 
          ref="wavePath1" 
          class="wave-path-1" 
          fill="url(#gradient)" 
          fill-opacity="0.53"
          d="M 0,600 C 0,600 0,300 0,300 C 61.258284241531655,281.49963181148746 122.51656848306331,262.999263622975 178,277 C 233.4834315169367,291.000736377025 283.1920103092784,337.50257731958766 343,353 C 402.8079896907216,368.49742268041234 472.7153902798233,352.99042709867456 545,351 C 617.2846097201767,349.00957290132544 691.9464285714287,360.53571428571433 743,335 C 794.0535714285713,309.46428571428567 821.4988954344624,246.86671575846833 885,248 C 948.5011045655376,249.13328424153167 1048.0579896907216,313.99742268041234 1112,341 C 1175.9420103092784,368.00257731958766 1204.2691458026509,357.1435935198822 1253,344 C 1301.7308541973491,330.8564064801178 1370.8654270986744,315.4282032400589 1440,300 C 1440,300 1440,600 1440,600 Z"
        />
        <path 
          ref="wavePath2" 
          class="wave-path-2" 
          fill="url(#gradient)" 
          fill-opacity="1"
          d="M 0,600 C 0,600 0,450 0,450 C 64.56038291605303,452.470176730486 129.12076583210606,454.940353460972 182,449 C 234.87923416789394,443.059646539028 276.07731958762884,428.708762886598 332,418 C 387.92268041237116,407.291237113402 458.5699558173786,400.2245949926362 521,411 C 583.4300441826214,421.7754050073638 637.642857142857,450.3928571428572 698,468 C 758.357142857143,485.6071428571428 824.858615611193,492.2039764359352 885,482 C 945.141384388807,471.7960235640648 998.9226804123709,444.791237113402 1061,427 C 1123.077319587629,409.208762886598 1193.4506627393228,400.63107511045655 1258,406 C 1322.5493372606772,411.36892488954345 1381.2746686303385,430.6844624447717 1440,450 C 1440,450 1440,600 1440,600 Z"
        />
      </svg>
    </div>
  </transition>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import anime from 'animejs'

const isLoading = ref(true)
const svgRefs = ref([])
const pathRefs = ref([])
const wavePath0 = ref(null)
const wavePath1 = ref(null)
const wavePath2 = ref(null)

// 定义形状变形路径
const morphPaths = {
  path1: [
    "M7.2,-1.9C13.8,7.4,27,15.3,26.9,27.4C26.7,39.5,13.4,55.8,0.9,55.3C-11.6,54.8,-23.1,37.4,-32.8,19.8C-42.5,2.2,-50.3,-15.7,-44.5,-24.5C-38.7,-33.3,-19.4,-33.1,-9.6,-27.6C0.2,-22.1,0.5,-11.2,7.2,-1.9Z",
    "M61.2,-21.3C75.1,-11.3,79.2,18.4,67.4,39.8C55.6,61.2,27.8,74.3,13.6,66.4C-0.5,58.6,-1,29.7,-14.6,7.3C-28.2,-15.2,-55,-31.2,-54.8,-33.3C-54.5,-35.5,-27.3,-23.7,-1.8,-22.7C23.6,-21.6,47.3,-31.3,61.2,-21.3Z",
    "M56.2,-46.7C57.6,-30,33,-12.6,19.3,3C5.6,18.6,2.8,32.4,-3.3,34.3C-9.4,36.2,-18.8,26.3,-28.1,13.2C-37.3,0.2,-46.3,-15.9,-41.6,-34.5C-36.9,-53.1,-18.4,-74.2,4.5,-76.8C27.4,-79.4,54.8,-63.4,56.2,-46.7Z"
  ],
  path2: [
    "M42.2,-23.7C55.3,-1.8,66.8,21.7,59.5,37.4C52.2,53.1,26.1,60.9,2.7,59.3C-20.7,57.8,-41.4,46.8,-43.7,34C-46,21.2,-30,6.6,-19.6,-13.8C-9.3,-34.1,-4.6,-60.2,5,-63C14.6,-65.9,29.2,-45.6,42.2,-23.7Z",
    "M36.3,-10.7C49.3,1.6,63.7,23.3,57.9,37.9C52.1,52.4,26,59.7,3.2,57.9C-19.6,56,-39.3,45,-50.2,27.6C-61.1,10.1,-63.2,-13.8,-53.4,-24.3C-43.6,-34.8,-21.8,-31.9,-5.1,-28.9C11.6,-26,23.3,-23.1,36.3,-10.7Z",
    "M25.2,-17.5C33.4,-0.3,41.5,14.2,37.2,32.2C33,50.2,16.5,71.9,5.3,68.9C-6,65.8,-12,38.1,-20.8,17.4C-29.7,-3.3,-41.4,-17,-38.4,-31.2C-35.4,-45.5,-17.7,-60.3,-4.6,-57.6C8.5,-54.9,17,-34.8,25.2,-17.5Z"
  ],
  path3: [
    "M25.1,-9.3C34.3,1.4,44.7,16.6,40.7,22.7C36.7,28.9,18.3,26,6.8,22C-4.7,18.1,-9.5,13.1,-19.6,3.5C-29.7,-6.2,-45.3,-20.7,-42.9,-27.4C-40.5,-34.2,-20.3,-33.2,-6.1,-29.7C8,-26.1,16,-20,25.1,-9.3Z",
    "M51.6,-25.2C59.2,-16.6,52.4,4.9,41.4,19.9C30.4,35,15.2,43.6,1.5,42.7C-12.3,41.9,-24.5,31.6,-28.5,20.6C-32.4,9.6,-28.1,-2,-21.9,-9.8C-15.8,-17.5,-7.9,-21.3,7.1,-25.4C22,-29.5,44,-33.8,51.6,-25.2Z",
    "M63.8,-42.3C71.7,-23.1,59.5,2.1,45.6,26.5C31.6,50.8,15.8,74.2,4.9,71.4C-5.9,68.5,-11.9,39.4,-20.3,18.3C-28.6,-2.8,-39.4,-15.9,-36.4,-32.2C-33.5,-48.6,-16.7,-68.2,5.6,-71.4C27.9,-74.7,55.9,-61.5,63.8,-42.3Z"
  ],
  path4: [
    "M20.8,2.7C30.2,22.1,43.2,49.8,38.7,53C34.2,56.2,12.1,34.9,-3.3,20C-18.7,5.2,-27.5,-3.3,-25.8,-12.1C-24.2,-20.9,-12.1,-29.9,-3.2,-28.9C5.7,-27.9,11.4,-16.7,20.8,2.7Z",
    "M19.8,1C25.1,9.9,28.4,26.9,16.2,39.9C4,52.9,-23.9,62.1,-43.1,50.2C-62.3,38.4,-72.9,5.6,-64.3,-7.9C-55.6,-21.4,-27.8,-15.6,-10.3,-12.3C7.2,-8.9,14.4,-8,19.8,1Z",
    "M51.6,-4.3C60.6,10.8,57.2,42.4,38.5,56.8C19.9,71.2,-13.9,68.4,-37,51.5C-60.1,34.6,-72.5,3.5,-64.6,-10.2C-56.6,-23.8,-28.3,-20.1,-3.5,-18.9C21.3,-17.8,42.7,-19.3,51.6,-4.3Z"
  ],
  path5: [
    "M33.1,-27.9C33.5,-18.5,17.8,-8.7,9.6,5.4C1.4,19.5,0.7,37.8,-3.3,39.7C-7.2,41.5,-14.4,27,-21.9,13.4C-29.4,-0.3,-37.1,-13.1,-33.5,-24.4C-29.9,-35.6,-14.9,-45.4,0.7,-45.8C16.4,-46.2,32.8,-37.3,33.1,-27.9Z",
    "M14.3,-10.1C22.3,5.7,35.3,16.8,33.7,19.8C32.2,22.8,16.1,17.7,4.7,15C-6.6,12.3,-13.2,11.9,-20.3,5.7C-27.4,-0.5,-34.9,-12.5,-31.6,-25.5C-28.3,-38.5,-14.1,-52.5,-5.5,-49.3C3.1,-46.2,6.2,-25.8,14.3,-10.1Z",
    "M23.1,-12.9C26.8,-6.9,24.6,3,19.8,20.4C14.9,37.7,7.5,62.5,-9,67.8C-25.5,73,-51,58.6,-56.3,40.9C-61.7,23.2,-46.9,2.3,-34.2,-8.9C-21.4,-20.1,-10.7,-21.6,-0.5,-21.3C9.7,-21,19.3,-18.9,23.1,-12.9Z"
  ]
}

const emit = defineEmits(['loaded'])

let animations = []

onMounted(() => {
  // 点动画
  anime({
    targets: '.dots',
    opacity: [0.5, 1],
    duration: 300,
    loop: true,
    easing: 'linear',
    delay: anime.stagger(300)
  })
  
  // SVG 上浮动画（延迟启动）
  const delays = [1500, 0, 2000, 2600, 3000]
  svgRefs.value.forEach((svg, i) => {
    if (svg) {
      anime({
        targets: svg,
        translateY: -window.innerHeight * 1.5,
        duration: 6000,
        loop: true,
        easing: 'linear',
        delay: delays[i]
      })
    }
  })
  
  // 形状变形动画
  pathRefs.value.forEach((path, i) => {
    if (path) {
      const pathKey = `path${i + 1}`
      anime({
        targets: path,
        d: morphPaths[pathKey],
        duration: 3500,
        loop: true,
        direction: 'alternate',
        easing: 'linear'
      })
    }
  })
  
  // 背景波浪动画
  animateWaves()
  
  // 模拟加载完成（3秒后）
  setTimeout(() => {
    isLoading.value = false
    emit('loaded')
  }, 1000)
})

const animateWaves = () => {
  // 第一层波浪路径
  const wave0Paths = [
    "M 0,600 C 0,600 0,150 0,150 C 69.07271723122237,168.37555228276878 138.14543446244474,186.75110456553756 189,187 C 239.85456553755526,187.24889543446244 272.4909793814433,169.37113402061854 327,173 C 381.5090206185567,176.62886597938146 457.8906480117821,201.76435935198822 526,185 C 594.1093519882179,168.23564064801178 653.9464285714286,109.57142857142857 722,94 C 790.0535714285714,78.42857142857143 866.3236377025036,105.9499263622975 917,131 C 967.6763622974964,156.0500736377025 992.7590206185569,178.62886597938143 1052,187 C 1111.2409793814431,195.37113402061857 1204.6402798232696,189.53460972017672 1275,181 C 1345.3597201767304,172.46539027982328 1392.6798600883653,161.23269513991164 1440,150 C 1440,150 1440,600 1440,600 Z",
    "M 0,600 C 0,600 0,150 0,150 C 52.505154639175245,119.69256259204712 105.01030927835049,89.38512518409425 164,94 C 222.9896907216495,98.61487481590575 288.46391752577324,138.1520618556701 345,150 C 401.53608247422676,161.8479381443299 449.13402061855663,146.00662739322536 514,130 C 578.8659793814434,113.99337260677466 660.9999999999999,97.82142857142856 718,122 C 775.0000000000001,146.17857142857144 806.8659793814435,210.7076583210604 868,204 C 929.1340206185565,197.2923416789396 1019.5360824742268,119.34793814432989 1085,107 C 1150.4639175257732,94.65206185567011 1190.9896907216494,147.90058910162006 1246,166 C 1301.0103092783506,184.09941089837994 1370.5051546391753,167.04970544918996 1440,150 C 1440,150 1440,600 1440,600 Z",
    "M 0,600 C 0,600 0,150 0,150 C 45.34407216494846,175.2928939617084 90.68814432989691,200.58578792341677 163,203 C 235.31185567010309,205.41421207658323 334.59149484536084,184.94974226804123 390,186 C 445.40850515463916,187.05025773195877 456.94587628865986,209.6152430044183 513,205 C 569.0541237113401,200.3847569955817 669.625,168.5892857142857 731,163 C 792.375,157.4107142857143 814.5541237113404,178.0276141384389 873,188 C 931.4458762886596,197.9723858615611 1026.1585051546392,197.30025773195874 1087,193 C 1147.8414948453608,188.69974226804126 1174.811855670103,180.77135493372606 1228,173 C 1281.188144329897,165.22864506627394 1360.5940721649486,157.61432253313697 1440,150 C 1440,150 1440,600 1440,600 Z",
    "M 0,600 C 0,600 0,150 0,150 C 43.71299705449191,163.7372974963181 87.42599410898382,177.4745949926362 153,190 C 218.57400589101618,202.5254050073638 306.0090206185567,213.83891752577318 376,194 C 445.9909793814433,174.16108247422682 498.53792341678934,123.16973490427098 559,105 C 619.4620765832107,86.83026509572902 687.8392857142857,101.48214285714286 748,104 C 808.1607142857143,106.51785714285714 860.1049337260678,96.90169366715757 914,97 C 967.8950662739322,97.09830633284243 1023.7409793814434,106.91108247422682 1080,122 C 1136.2590206185566,137.08891752577318 1192.931148748159,157.4539764359352 1253,163 C 1313.068851251841,168.5460235640648 1376.5344256259204,159.2730117820324 1440,150 C 1440,150 1440,600 1440,600 Z"
  ]
  
  // 第二层波浪路径
  const wave1Paths = [
    "M 0,600 C 0,600 0,300 0,300 C 61.258284241531655,281.49963181148746 122.51656848306331,262.999263622975 178,277 C 233.4834315169367,291.000736377025 283.1920103092784,337.50257731958766 343,353 C 402.8079896907216,368.49742268041234 472.7153902798233,352.99042709867456 545,351 C 617.2846097201767,349.00957290132544 691.9464285714287,360.53571428571433 743,335 C 794.0535714285713,309.46428571428567 821.4988954344624,246.86671575846833 885,248 C 948.5011045655376,249.13328424153167 1048.0579896907216,313.99742268041234 1112,341 C 1175.9420103092784,368.00257731958766 1204.2691458026509,357.1435935198822 1253,344 C 1301.7308541973491,330.8564064801178 1370.8654270986744,315.4282032400589 1440,300 C 1440,300 1440,600 1440,600 Z",
    "M 0,600 C 0,600 0,300 0,300 C 74.61321796759941,319.3628497790869 149.22643593519882,338.7256995581738 212,328 C 274.7735640648012,317.2743004418262 325.7074742268041,276.46005154639175 379,275 C 432.2925257731959,273.53994845360825 487.94366715758474,311.4340942562592 540,335 C 592.0563328424153,358.5659057437408 640.517857142857,367.8035714285715 700,355 C 759.482142857143,342.1964285714285 829.9849042709869,307.3516200294551 892,304 C 954.0150957290131,300.6483799705449 1007.5425257731956,328.7899484536082 1062,332 C 1116.4574742268044,335.2100515463918 1171.8449926362298,313.488586156112 1235,304 C 1298.1550073637702,294.511413843888 1369.077503681885,297.255706921944 1440,300 C 1440,300 1440,600 1440,600 Z"
  ]
  
  // 第三层波浪路径
  const wave2Paths = [
    "M 0,600 C 0,600 0,450 0,450 C 64.56038291605303,452.470176730486 129.12076583210606,454.940353460972 182,449 C 234.87923416789394,443.059646539028 276.07731958762884,428.708762886598 332,418 C 387.92268041237116,407.291237113402 458.5699558173786,400.2245949926362 521,411 C 583.4300441826214,421.7754050073638 637.642857142857,450.3928571428572 698,468 C 758.357142857143,485.6071428571428 824.858615611193,492.2039764359352 885,482 C 945.141384388807,471.7960235640648 998.9226804123709,444.791237113402 1061,427 C 1123.077319587629,409.208762886598 1193.4506627393228,400.63107511045655 1258,406 C 1322.5493372606772,411.36892488954345 1381.2746686303385,430.6844624447717 1440,450 C 1440,450 1440,600 1440,600 Z",
    "M 0,600 C 0,600 0,450 0,450 C 56.64598674521355,433.2312223858616 113.2919734904271,416.4624447717232 178,410 C 242.7080265095729,403.5375552282768 315.47809278350513,407.381443298969 379,405 C 442.52190721649487,402.618556701031 496.7956553755522,394.0117820324007 554,401 C 611.2043446244478,407.9882179675993 671.3392857142858,430.5714285714285 726,446 C 780.6607142857142,461.4285714285715 829.8472017673049,469.7025036818852 890,457 C 950.1527982326951,444.2974963181148 1021.2719072164948,410.6185567010309 1092,407 C 1162.7280927835052,403.3814432989691 1233.065169366716,429.8232695139912 1291,442 C 1348.934830633284,454.1767304860088 1394.467415316642,452.08836524300443 1440,450 C 1440,450 1440,600 1440,600 Z"
  ]
  
  if (wavePath0.value) {
    anime({
      targets: wavePath0.value,
      d: wave0Paths,
      duration: 4000,
      loop: true,
      easing: 'linear'
    })
  }
  
  if (wavePath1.value) {
    anime({
      targets: wavePath1.value,
      d: wave1Paths,
      duration: 4000,
      loop: true,
      easing: 'linear'
    })
  }
  
  if (wavePath2.value) {
    anime({
      targets: wavePath2.value,
      d: wave2Paths,
      duration: 4000,
      loop: true,
      easing: 'linear'
    })
  }
}

onUnmounted(() => {
  animations.forEach(anim => anim.pause())
})
</script>

<style scoped>
@import url('https://fonts.googleapis.com/css2?family=Bruno+Ace+SC&display=swap');

.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: #fbfcfd;
  z-index: 9999;
  overflow: hidden;
}

.loader {
  position: absolute;
  width: 20em;
  height: 2em;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;
  text-align: center;
  z-index: 4;
  font-family: 'Bruno Ace SC', sans-serif;
}

.loader h1 {
  font-size: 2rem;
  color: #927db7;
}

.dots {
  letter-spacing: 5px;
  opacity: 0.5;
  transition: all 300ms ease-out;
}

.svg-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
  position: absolute;
  width: 100%;
  bottom: 0;
}

.svg {
  width: 10em;
  position: relative;
  bottom: -90vh;
  z-index: 2;
}

.background-waves {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 3;
  height: auto;
}

.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
</style>

